// ==UserScript==
// @name        simple-fmc-gefs-plugin
// @namespace   andermatt64-gefs-plugins
// @version     0.0.1
// @description Simple FMC GEFS Plugin
// @author      andermatt64
// @match       http://*.gefs-online.com/gefs.php
// @grant       none
// ==/UserScript==

var APS={mode:"hold",content:null,init:function(a){APS.content=a}},SimpleFMC={timerID:null,updateFnList:[],init:function(){Log.init(UI.logContainer),Status.init(UI.statusContainer),APS.init(UI.apsContainer),Route.init(UI.routeContainer),Info.init(UI.infoContainer),SimpleFMC.timerID=setInterval(SimpleFMC.backgroundUpdate,1e3)},registerUpdate:function(a){SimpleFMC.updateFnList.push(a)},backgroundUpdate:function(){for(var a=0;a<SimpleFMC.updateFnList.length;a++)SimpleFMC.updateFnList[a]()},fini:function(){null!==SimpleFMC.timerID&&clearInterval(SimpleFMC.timerID)}},Info={content:null,init:function(a){Info.content=null}},Log={content:null,init:function(a){Log.content=a,Log.content.css("overflow-y","scroll").css("overflow-x","auto").css("line-height","1.3").css("height","290px")},info:function(a){Log._write(Log._entry("#9be651",a))},warning:function(a){Log._write(Log._entry("#ffc300",a))},error:function(a){Log._write(Log._entry("#d14537",a))},clear:function(){Log.content.empty()},_entry:function(a,b){var c=$("<div></div>");return c.css("color",a).text(b),c},_write:function(a){Log.content.prepend(a)}};!function(){"use strict";var a=function(){UI.init(),SimpleFMC.init()},b=setInterval(function(){if(window.gefs&&gefs.init)if(clearInterval(b),gefs.canvas)a();else{var c=gefs.init;gefs.init=function(){c(),a()}}},16)}();var Route={content:null,init:function(a){Route.content=a}},makeStatusPanel=function(){var a=$("<div></div>");return a.css("width","25%").css("height","100px").css("float","left"),a},Throttle={_panel:null,_fill:null,_label:null,_meter:null,init:function(a){Throttle._panel=makeStatusPanel(),Throttle._meter=$("<div></div>"),Throttle._meter.css("margin-top","5px").css("margin-bottom","5px").css("margin-left","5px").css("border","1px solid #0f0").css("width","10px").css("height","80px").css("background","#0f0").css("float","left"),Throttle._fill=$("<div></div>"),Throttle._fill.css("background","#000").css("height","100%");var b=$("<div></div>");b.css("padding-top","5px").css("padding-left","5px").css("color","#0f0").css("float","left"),Throttle._label=$("<span></span>"),b.text("THROT").append($("<br>")).append(Throttle._label),Throttle._meter.append(Throttle._fill),Throttle._panel.append(Throttle._meter).append(b),a.append(Throttle._panel)},update:function(a){var b=parseInt(100*a);Throttle._fill.css("height",(100-Math.abs(b)).toString()+"%"),b<0?(b=-b,Throttle._meter.css("background","#ff8400"),Throttle._label.css("color","#ff8400")):(Throttle._meter.css("background","#0f0"),Throttle._label.css("color","#0f0"));var c=b.toString();1===c.length?c="00"+c:2===c.length&&(c="0"+c),Throttle._label.text(c+"/100")}},Status={content:null,init:function(a){Status.content=a,Throttle.init(a),SimpleFMC.registerUpdate(function(){Throttle.update(gefs.aircraft.animationValue.throttle)})}},UI={FmcHeight:"300px",infoContainer:null,statusContainer:null,apsContainer:null,routeContainer:null,logContainer:null,init:function(){$(".gefs-map-list").css("border-bottom",UI.FmcHeight+" solid transparent");var a=$(".gefs-autopilot");a.empty().css("height",UI.FmcHeight).css("font-family","Lucida Console, Monaco, monospace").css("font-size","9pt").css("padding","0 0 0 0");var b=function(a,b){var c=$("<button></button>");return c.text(a).css("width","100%").css("font-family","Lucida Console, Monaco, monospace").css("font-weight","bold").css("font-size","8pt").css("text-align","left").css("transition-duration","0.4s").css("border-top","1px solid #000").css("border-left","1px solid #000"),void 0!==b&&b&&c.css("border-bottom","1px solid #000"),c},c=$("<div></div>");c.css("float","left").css("width","10%").css("margin-right","0px").css("padding-right","0px");var d=$("<div></div>");d.css("float","left").css("background","#000").css("color","#0f0").css("width","90%").css("height","300px").css("margin-right","0px").css("padding-right","0px"),UI.infoContainer=$("<div></div>"),UI.infoContainer.css("padding","5px"),UI.statusContainer=$("<div></div>"),UI.statusContainer.css("padding","5px"),UI.apsContainer=$("<div></div>"),UI.apsContainer.css("padding","5px"),UI.routeContainer=$("<div></div>"),UI.routeContainer.css("padding","5px"),UI.logContainer=$("<div></div>"),UI.logContainer.css("padding","5px");var e=b("INFO");e.click(function(){d.empty(),d.append(UI.infoContainer)});var f=b("STAT");f.click(function(){d.empty(),d.append(UI.statusContainer)});var g=b("APS");g.click(function(){d.empty(),d.append(UI.apsContainer)});var h=b("RTE");h.click(function(){d.empty(),d.append(UI.routeContainer)});var i=b("LOG",!0);i.click(function(){d.empty(),d.append(UI.logContainer)}),d.append(UI.infoContainer),c.append(e).append(f).append(g).append(h).append(i),a.append(c).append(d)}},Utils={toRadians:function(a){return a*(Math.PI/180)},toDegrees:function(a){return a*(180/Math.PI)},getGreatCircleBearing:function(a,b){var c=Utils.toRadians(a.lat),d=Utils.toRadians(a.lon),e=Utils.toRadians(b.lat),f=Utils.toRadians(b.lon),g=Math.sin(f-d)*Math.cos(e),h=Math.cos(c)*Math.sin(e)-Math.sin(c)*Math.cos(e)*Math.cos(f-d),i=Math.atan2(g,h);return(Utils.toDegrees(i)+360)%360},getGreatCircleDistance:function(a,b){var c=6371e3,d=Utils.toRadians(a.lat),e=Utils.toRadians(b.lat),f=Utils.toRadians(b.lat-a.lat),g=Utils.toRadians(b.lon-a.lon),h=Math.sin(f/2)*Math.sin(f/2)+Math.cos(d)*Math.cos(e)*Math.sin(g/2)*Math.sin(g/2),i=2*Math.atan2(Math.sqrt(h),Math.sqrt(1-h)),j=c*i;return j/1e3}};